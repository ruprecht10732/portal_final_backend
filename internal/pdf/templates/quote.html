<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Offerte</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* ─── RESET & BASE ─────────────────────────────────── */
        @page { margin: 0; size: A4; }
        
        *, *::before, *::after {
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        body {
            margin: 0;
            padding: 0;
            /* "Bone" white - looks like expensive stationary */
            background-color: #FDFBF7; 
            color: #1C1917; /* Charcoal, not pure black */
            font-family: 'Montserrat', sans-serif;
            font-size: 9pt;
            line-height: 1.6;
        }

        /* ─── TYPOGRAPHY ───────────────────────────────────── */
        h1, h2, h3 { margin: 0; font-family: 'Cormorant Garamond', serif; }
        
        .serif { font-family: 'Cormorant Garamond', serif; }
        .sans { font-family: 'Montserrat', sans-serif; }
        
        .uppercase { text-transform: uppercase; letter-spacing: 0.15em; }
        .gold { color: #C5A065; }
        .bold { font-weight: 600; }
        .text-right { text-align: right; }

        /* ─── LAYOUT UTILS ─────────────────────────────────── */
        .container {
            width: 100%;
            /* No margins per request, but padding for content safety */
            padding: 40px; 
        }

        .divider {
            height: 1px;
            background-color: #E5E5E5;
            margin: 20px 0;
        }

        .gold-line {
            height: 2px;
            background-color: #C5A065;
            width: 60px;
            margin-bottom: 20px;
        }

        /* ─── HEADER ───────────────────────────────────────── */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 60px;
            border-bottom: 1px solid #1C1917;
            padding-bottom: 20px;
        }

        .logo-box img {
            max-height: 80px;
            max-width: 250px;
            /* Filter allows logos to blend better if they have white bg */
            mix-blend-mode: multiply; 
        }

        .logo-box .fallback {
            font-family: 'Cormorant Garamond', serif;
            font-size: 24pt;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .doc-title {
            text-align: right;
        }

        .doc-title h1 {
            font-size: 36pt;
            font-weight: 400;
            letter-spacing: 0.1em;
            line-height: 1;
        }

        .doc-title .ref {
            font-family: 'Montserrat', sans-serif;
            font-size: 9pt;
            color: #C5A065;
            margin-top: 5px;
            font-weight: 500;
        }

        /* ─── ADDRESS GRID ─────────────────────────────────── */
        .address-grid {
            display: flex;
            gap: 40px;
            margin-bottom: 50px;
        }

        .col { flex: 1; }
        .col-right { text-align: right; }

        .label {
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #C5A065; /* Gold Accent */
            margin-bottom: 8px;
            display: block;
        }

        .value-primary {
            font-family: 'Cormorant Garamond', serif;
            font-size: 14pt;
            font-weight: 600;
            margin-bottom: 5px;
            color: #1C1917;
        }

        .value-details {
            color: #57534E; /* Stone-500 */
            font-size: 8.5pt;
            line-height: 1.8;
        }

        /* ─── STATUS STAMP ─────────────────────────────────── */
        /* Minimalist, textual status. No childish colored backgrounds */
        .status-text {
            display: inline-block;
            margin-top: 10px;
            font-family: 'Montserrat', sans-serif;
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 4px 0;
            border-bottom: 1px solid transparent;
        }
        
        /* Subtle coloring for status */
        .status-Accepted { color: #15803d; border-color: #15803d; } /* Deep Emerald */
        .status-Rejected { color: #b91c1c; border-color: #b91c1c; } /* Deep Crimson */
        .status-Pending  { color: #C5A065; border-color: #C5A065; } /* Gold */

        /* ─── LUXURY TABLE ─────────────────────────────────── */
        .table-container {
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            font-family: 'Montserrat', sans-serif;
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #78716C;
            padding-bottom: 15px;
            border-bottom: 1px solid #E7E5E4;
        }

        td {
            padding: 16px 0;
            border-bottom: 1px solid #F0EFEA; /* Very subtle line */
            vertical-align: top;
            color: #1C1917;
        }

        /* Tabular nums for perfect alignment of prices */
        .nums {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .item-desc {
            font-family: 'Cormorant Garamond', serif;
            font-size: 12pt;
            font-weight: 600;
        }

        .item-meta {
            font-family: 'Montserrat', sans-serif;
            font-size: 7.5pt;
            color: #C5A065;
            margin-top: 2px;
            font-style: italic;
        }

        /* Deselected items: Low opacity, no strikethrough (looks messy) */
        tr.deselected { opacity: 0.3; }

        /* ─── TOTALS SECTION ───────────────────────────────── */
        .totals-section {
            display: flex;
            justify-content: flex-end;
            page-break-inside: avoid;
        }

        .totals-box {
            width: 40%;
            min-width: 250px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 9pt;
        }

        .total-row.grand {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 3px double #1C1917; /* Double line = classic accounting style */
            align-items: baseline;
        }

        .total-row.grand .label {
            font-size: 10pt;
            color: #1C1917;
            font-weight: 700;
        }

        .total-row.grand .value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 18pt;
            font-weight: 700;
        }

        /* ─── FOOTER & TERMS ───────────────────────────────── */
        .footer {
            margin-top: 80px;
            display: flex;
            gap: 40px;
            border-top: 1px solid #1C1917;
            padding-top: 20px;
        }

        .footer-col { flex: 1; }

        .footer-title {
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #C5A065;
            margin-bottom: 10px;
        }

        .footer-text {
            font-size: 8pt;
            color: #57534E;
            line-height: 1.8;
        }

        .footer-text ol {
            padding-left: 15px;
            margin: 0;
        }
    </style>
</head>
<body>

    <div class="container">
        
        <header class="header">
            <div class="logo-box">
                {{if .LogoBase64}}
                    <img src="data:{{.LogoMimeType}};base64,{{.LogoBase64}}" alt="Logo">
                {{else}}
                    <div class="fallback">{{.OrganizationName}}</div>
                {{end}}
            </div>
            <div class="doc-title">
                <h1 class="uppercase">Offerte</h1>
                <div class="ref uppercase">REF. {{.QuoteNumber}}</div>
            </div>
        </header>

        <div class="address-grid">
            <div class="col">
                <span class="label">Van</span>
                <div class="value-primary">{{.OrganizationName}}</div>
                <div class="value-details">
                    {{if .OrgAddressLine1}}{{.OrgAddressLine1}}{{end}}{{if .OrgAddressLine2}}, {{.OrgAddressLine2}}{{end}}<br>
                    {{if or .OrgPostalCode .OrgCity}}{{.OrgPostalCode}} {{.OrgCity}}<br>{{end}}
                    {{if .OrgEmail}}{{.OrgEmail}}<br>{{end}}
                    {{if .OrgKvkNumber}}KVK {{.OrgKvkNumber}}{{end}}
                </div>
            </div>

            <div class="col">
                <span class="label">Voor</span>
                <div class="value-primary">{{.CustomerName}}</div>
            </div>

            <div class="col col-right">
                <span class="label">Details</span>
                <div class="value-details">
                    <span class="bold">Datum:</span> {{.CreatedAtFormatted}}<br>
                    {{if .ValidUntilFormatted}}<span class="bold">Geldig tot:</span> {{.ValidUntilFormatted}}<br>{{end}}
                </div>
                
                <div class="status-text status-{{.Status}}">
                    {{if eq .Status "Accepted"}}Geaccepteerd{{else if eq .Status "Rejected"}}Afgewezen{{else}}{{.StatusLabel}}{{end}}
                </div>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 50%">Omschrijving</th>
                        <th style="width: 10%" class="text-right">Aantal</th>
                        <th style="width: 20%" class="text-right">Prijs</th>
                        <th style="width: 20%" class="text-right">Totaal</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Items}}
                    <tr class="{{if and .IsOptional (not .IsSelected)}}deselected{{end}}">
                        <td>
                            <div class="item-desc">{{.Description}}</div>
                            {{if .IsOptional}}
                                <div class="item-meta">
                                    {{if .IsSelected}}Optioneel (Geselecteerd){{else}}Optioneel (Niet geselecteerd){{end}}
                                </div>
                            {{end}}
                        </td>
                        <td class="text-right nums">{{.Quantity}}</td>
                        <td class="text-right nums">{{.UnitPriceFormatted}}</td>
                        <td class="text-right nums bold">{{.LineTotalFormatted}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>

        <div class="totals-section">
            <div class="totals-box">
                <div class="total-row">
                    <span class="label">Subtotaal</span>
                    <span class="value nums">{{.SubtotalFormatted}}</span>
                </div>
                {{if .HasDiscount}}
                <div class="total-row" style="color: #15803d;">
                    <span class="label">Korting</span>
                    <span class="value nums">-{{.DiscountFormatted}}</span>
                </div>
                {{end}}
                {{range .VatBreakdown}}
                <div class="total-row">
                    <span class="label">BTW {{.PctFormatted}}</span>
                    <span class="value nums">{{.AmountFormatted}}</span>
                </div>
                {{end}}
                
                <div class="total-row grand">
                    <span class="label uppercase">Totaal</span>
                    <span class="value nums">{{.TotalFormatted}}</span>
                </div>
            </div>
        </div>

        <footer class="footer">
            {{if .Notes}}
            <div class="footer-col">
                <div class="footer-title">Opmerkingen</div>
                <div class="footer-text">{{.Notes}}</div>
            </div>
            {{end}}
            
            <div class="footer-col">
                <div class="footer-title">Voorwaarden</div>
                <div class="footer-text">
                    <ol>
                        <li>Betaling binnen {{.PaymentDays}} dagen.</li>
                        <li>Offerte is {{.QuoteValidDays}} dagen geldig.</li>
                        <li>Algemene voorwaarden zijn van toepassing.</li>
                    </ol>
                </div>
            </div>
        </footer>

    </div>
</body>
</html>