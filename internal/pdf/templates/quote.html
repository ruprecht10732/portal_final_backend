<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;500;600;700;800&display=swap');

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Barlow', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #111827;
            font-size: 9pt;
            line-height: 1.5;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .page {
            padding: 0;
        }

        /* ── Accent color from cover page ─────────────────── */
        :root {
            --accent: #F59E0B;
            --accent-light: #FEF3C7;
            --dark: #111827;
            --gray-500: #6b7280;
            --gray-400: #9ca3af;
            --gray-200: #e5e7eb;
            --gray-100: #f3f4f6;
            --gray-50: #f9fafb;
            --slate-200: #e2e8f0;
            --slate-100: #f1f5f9;
            --green-600: #16a34a;
            --green-100: #dcfce7;
            --red-600: #dc2626;
            --red-100: #fee2e2;
        }

        /* ── Header ────────────────────────────────────────── */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 3px solid var(--accent);
        }

        .header-logo img {
            max-height: 52px;
            max-width: 180px;
        }

        .header-logo .org-name-fallback {
            font-size: 18pt;
            font-weight: 700;
            color: var(--dark);
        }

        .header-title {
            text-align: right;
        }

        .header-title h1 {
            font-size: 20pt;
            font-weight: 800;
            color: var(--dark);
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1.1;
        }

        .header-title .quote-number {
            font-size: 10pt;
            color: var(--gray-500);
            margin-top: 4px;
            font-weight: 400;
        }

        /* ── Address Block ─────────────────────────────────── */
        .address-block {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
        }

        .address-col {
            flex: 1;
        }

        .address-col.meta {
            flex: 0 0 200px;
            text-align: right;
        }

        .address-label {
            font-size: 7pt;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .address-name {
            font-size: 10pt;
            font-weight: 600;
            color: var(--dark);
        }

        .address-detail {
            font-size: 8.5pt;
            color: var(--gray-500);
            line-height: 1.6;
        }

        .meta-row {
            font-size: 8.5pt;
            color: var(--gray-500);
            line-height: 1.8;
        }

        .meta-row .label {
            color: var(--gray-400);
        }

        .meta-row .value {
            font-weight: 600;
            color: var(--dark);
        }

        .meta-row.status .value {
            font-weight: 700;
        }

        .status-accepted { color: var(--green-600); }
        .status-rejected { color: var(--red-600); }
        .status-sent     { color: var(--accent); }
        .status-default  { color: var(--gray-500); }

        /* ── Status Banner ─────────────────────────────────── */
        .status-banner {
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 9pt;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .status-banner.accepted {
            background-color: var(--green-100);
            color: var(--green-600);
            border-left: 4px solid var(--green-600);
        }

        .status-banner.rejected {
            background-color: var(--red-100);
            color: var(--red-600);
            border-left: 4px solid var(--red-600);
        }

        /* ── Items Table ───────────────────────────────────── */
        .section-title {
            font-size: 8pt;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .items-table thead th {
            background-color: var(--dark);
            color: #ffffff;
            font-size: 7.5pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 9px 10px;
            text-align: left;
        }

        .items-table thead th.right {
            text-align: right;
        }

        .items-table tbody td {
            font-size: 8.5pt;
            padding: 8px 10px;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: top;
        }

        .items-table tbody td.right {
            text-align: right;
        }

        .items-table tbody tr:nth-child(even) {
            background-color: var(--gray-50);
        }

        .items-table tbody tr.deselected td {
            color: #a0a0a0;
        }

        .optional-badge {
            font-size: 7pt;
            color: var(--gray-500);
            font-style: italic;
        }

        .optional-badge.deselected {
            color: #a0a0a0;
        }

        /* ── Totals ────────────────────────────────────────── */
        .totals-block {
            margin-left: auto;
            width: 300px;
            border-top: 2px solid var(--gray-200);
            padding-top: 8px;
        }

        .totals-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 9pt;
        }

        .totals-row .label {
            color: var(--gray-500);
            font-weight: 500;
        }

        .totals-row .value {
            color: var(--dark);
            font-weight: 600;
        }

        .totals-row.discount .value {
            color: var(--green-600);
        }

        .totals-row.grand-total {
            margin-top: 8px;
            padding: 12px 14px;
            background-color: var(--accent);
            border-radius: 4px;
            font-size: 12pt;
            font-weight: 800;
        }

        .totals-row.grand-total .label,
        .totals-row.grand-total .value {
            color: #ffffff;
            font-weight: 800;
        }

        /* ── Notes ─────────────────────────────────────────── */
        .notes-block {
            margin-top: 20px;
            padding: 12px 14px;
            background-color: var(--accent-light);
            border-left: 4px solid var(--accent);
            border-radius: 4px;
        }

        .notes-block .notes-title {
            font-size: 8pt;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .notes-block .notes-text {
            font-size: 8.5pt;
            color: var(--gray-500);
            white-space: pre-wrap;
        }

        /* ── Legal Terms ───────────────────────────────────── */
        .legal-terms {
            margin-top: 24px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
        }

        .legal-terms .legal-title {
            font-size: 7pt;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .legal-terms ol {
            padding-left: 16px;
            font-size: 7pt;
            color: var(--gray-500);
            line-height: 1.6;
        }

        .legal-terms li {
            margin-bottom: 2px;
        }

        /* ── Signature Block ───────────────────────────────── */
        .signature-block {
            margin-top: 24px;
            padding-top: 12px;
            border-top: 2px solid var(--accent);
        }

        .signature-block .sig-title {
            font-size: 8pt;
            font-weight: 700;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .signature-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .signature-info .sig-name {
            font-size: 9pt;
            font-weight: 700;
            color: var(--dark);
        }

        .signature-info .sig-date {
            font-size: 9pt;
            color: var(--gray-500);
        }

        .signature-image-row {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            margin-top: 8px;
        }

        .signature-image-row .sig-label {
            font-size: 8pt;
            color: var(--gray-500);
            padding-bottom: 8px;
        }

        .signature-image-row img {
            max-height: 60px;
            max-width: 200px;
            border-bottom: 1px solid var(--gray-200);
        }

        @media print {
            body { background: none; padding: 0; margin: 0; }
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- ── Header ──────────────────────────────────────── -->
        <div class="header">
            <div class="header-logo">
                {{if .LogoBase64}}
                    <img src="data:{{.LogoMimeType}};base64,{{.LogoBase64}}" alt="Logo">
                {{else}}
                    <span class="org-name-fallback">{{.OrganizationName}}</span>
                {{end}}
            </div>
            <div class="header-title">
                <h1>OFFERTE</h1>
                <div class="quote-number">{{.QuoteNumber}}</div>
            </div>
        </div>

        <!-- ── Address Block ───────────────────────────────── -->
        <div class="address-block">
            <div class="address-col">
                <div class="address-label">Van</div>
                <div class="address-name">{{.OrganizationName}}</div>
                <div class="address-detail">
                    {{if .OrgAddressLine1}}{{.OrgAddressLine1}}{{end}}{{if .OrgAddressLine2}}, {{.OrgAddressLine2}}{{end}}<br>
                    {{if or .OrgPostalCode .OrgCity}}{{.OrgPostalCode}} {{.OrgCity}}<br>{{end}}
                    {{if .OrgEmail}}{{.OrgEmail}}{{end}}{{if and .OrgEmail .OrgPhone}} &nbsp;|&nbsp; {{end}}{{if .OrgPhone}}{{.OrgPhone}}{{end}}<br>
                    {{if .OrgKvkNumber}}KVK: {{.OrgKvkNumber}}{{end}}{{if and .OrgKvkNumber .OrgVatNumber}} &nbsp;|&nbsp; {{end}}{{if .OrgVatNumber}}BTW: {{.OrgVatNumber}}{{end}}
                </div>
            </div>
            <div class="address-col">
                <div class="address-label">Aan</div>
                <div class="address-name">{{.CustomerName}}</div>
            </div>
            <div class="address-col meta">
                <div class="meta-row"><span class="label">Datum:</span> <span class="value">{{.CreatedAtFormatted}}</span></div>
                {{if .ValidUntilFormatted}}<div class="meta-row"><span class="label">Geldig tot:</span> <span class="value">{{.ValidUntilFormatted}}</span></div>{{end}}
                <div class="meta-row status"><span class="label">Status:</span> <span class="value {{.StatusClass}}">{{.StatusLabel}}</span></div>
            </div>
        </div>

        <!-- ── Status Banner ───────────────────────────────── -->
        {{if eq .Status "Accepted"}}
        <div class="status-banner accepted">
            ✓ Offerte geaccepteerd{{if .AcceptedAtFormatted}} op {{.AcceptedAtFormatted}}{{end}}
        </div>
        {{end}}
        {{if eq .Status "Rejected"}}
        <div class="status-banner rejected">
            ✗ Offerte afgewezen
        </div>
        {{end}}

        <!-- ── Line Items ──────────────────────────────────── -->
        <div class="section-title">Onderdelen</div>
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 42%">Omschrijving</th>
                    <th style="width: 10%">Aantal</th>
                    <th style="width: 16%" class="right">Stuksprijs</th>
                    <th style="width: 10%" class="right">BTW</th>
                    <th style="width: 22%" class="right">Bedrag</th>
                </tr>
            </thead>
            <tbody>
                {{range .Items}}
                <tr{{if and .IsOptional (not .IsSelected)}} class="deselected"{{end}}>
                    <td>
                        {{.Description}}
                        {{if .IsOptional}}
                            {{if .IsSelected}}
                                <span class="optional-badge">(optioneel)</span>
                            {{else}}
                                <span class="optional-badge deselected">(optioneel - niet geselecteerd)</span>
                            {{end}}
                        {{end}}
                    </td>
                    <td>{{.Quantity}}</td>
                    <td class="right">{{.UnitPriceFormatted}}</td>
                    <td class="right">{{.VatPctFormatted}}</td>
                    <td class="right">{{.LineTotalFormatted}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>

        <!-- ── Totals ──────────────────────────────────────── -->
        <div class="totals-block">
            <div class="totals-row">
                <span class="label">Subtotaal</span>
                <span class="value">{{.SubtotalFormatted}}</span>
            </div>
            {{if .HasDiscount}}
            <div class="totals-row discount">
                <span class="label">Korting</span>
                <span class="value">-{{.DiscountFormatted}}</span>
            </div>
            {{end}}
            {{range .VatBreakdown}}
            <div class="totals-row">
                <span class="label">BTW {{.PctFormatted}}</span>
                <span class="value">{{.AmountFormatted}}</span>
            </div>
            {{end}}
            <div class="totals-row grand-total">
                <span class="label">TOTAAL</span>
                <span class="value">{{.TotalFormatted}}</span>
            </div>
        </div>

        <!-- ── Notes ───────────────────────────────────────── -->
        {{if .Notes}}
        <div class="notes-block">
            <div class="notes-title">Opmerkingen</div>
            <div class="notes-text">{{.Notes}}</div>
        </div>
        {{end}}

        <!-- ── Legal Terms ─────────────────────────────────── -->
        <div class="legal-terms">
            <div class="legal-title">Voorwaarden</div>
            <ol>
                <li>Deze offerte is vrijblijvend en onder voorbehoud van tussentijdse wijzigingen.</li>
                <li>Betaling dient te geschieden binnen 14 dagen na factuurdatum, tenzij anders overeengekomen.</li>
                <li>Op al onze offertes, overeenkomsten en leveringen zijn onze algemene voorwaarden van toepassing.</li>
                <li>Alle genoemde bedragen zijn in euro's. BTW is gespecificeerd conform Nederlandse wetgeving.</li>
            </ol>
        </div>

        <!-- ── Signature Block ─────────────────────────────── -->
        {{if .HasSignature}}
        <div class="signature-block">
            <div class="sig-title">Akkoordverklaring</div>
            <div class="signature-info">
                <span class="sig-name">Geaccepteerd door: {{.SignatureName}}</span>
                <span class="sig-date">Datum: {{.AcceptedAtFormatted}}</span>
            </div>
            {{if .SignatureBase64}}
            <div class="signature-image-row">
                <span class="sig-label">Handtekening:</span>
                <img src="data:image/png;base64,{{.SignatureBase64}}" alt="Handtekening">
            </div>
            {{end}}
        </div>
        {{end}}
    </div>
</body>
</html>
